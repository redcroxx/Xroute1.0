<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="P100200POPUPMapper">
	<!-- 미입고 애터미 발주내역 : 마스터 그리드 검색 -->
	<select id="getSearch" parameterType="LDataMap" resultType="LDataMap">
		/* alexcloud.p100.p100200_popup.getSearch */
		SELECT A.COMPCD
			 , A.ORGCD
			 , A.IDX
			 , A.ORDERNO
			 , A.ORDERSUBNO
			 , A.ORDERSEQ
			 , A.ORDERDATE
			 , A.TYPE
			 , A.MATERIALCODE
			 , A.MATERIALNAME
			 , A.PLANTCODE
			 , A.PLANTNAME
			 , A.STORAGECODE
			 , A.STORAGENAME
			 , A.STOCKCOUNT
			 , A.STOCKDATE
			 , A.COMPANYCODE
			 , A.COMPANYNAME
			 , A.MEINS
			 , A.ORDERPRICE
			 , A.TOTALPRICE
			 , A.STATUS
			 , A.OPERATEDATE
			 , A.OPERATETIME
			 , A.OPERATEID
			 , A.LOGINO
			 , A.LOGISUBNO
			 , A.TYPETEXT
			 , A.RETURNNO
			 , A.RETURNSUBNO
			 , A.RETURNMONTH
			 , A.BUYNUM
			 , A.BUYSEQ
			 , A.QTY
			 , A.RMK
			 , A.VALID_DATE
			 , A.LOT
			 , A.INTF_YN
			 , A.INTF_DATE
			 , A.TRS_DATE
			 , A.INTF_RETURN_YN
			 , A.INTF_RETURN_DATE
			 , A.IN_SNO
			 , A.LOGIFLAG
			 , A.LOGISEQ
			 , A.LOGICOUNT
			 , A.OUT_SNO	
			, CASE WHEN A.STORAGECODE = '1100' THEN '2000'
			 		WHEN A.STORAGECODE = '1180' THEN '2180'
			 		WHEN A.STORAGECODE = '1190' THEN '2190'
			 		WHEN A.STORAGECODE = '1200' THEN '4000'
			 		WHEN A.STORAGECODE = '1280' THEN '4280'
			 		WHEN A.STORAGECODE = '1290' THEN '4290'
			   END AS WHCD
			 , CASE WHEN A.STORAGECODE = '1100' THEN (SELECT NAME FROM P004 WHERE WHCD = '2000')
			 		WHEN A.STORAGECODE = '1180' THEN (SELECT NAME FROM P004 WHERE WHCD = '2180')
			 		WHEN A.STORAGECODE = '1190' THEN (SELECT NAME FROM P004 WHERE WHCD = '2190')
			 		WHEN A.STORAGECODE = '1200' THEN (SELECT NAME FROM P004 WHERE WHCD = '4000')
			 		WHEN A.STORAGECODE = '1280' THEN (SELECT NAME FROM P004 WHERE WHCD = '4280')
			 		WHEN A.STORAGECODE = '1290' THEN (SELECT NAME FROM P004 WHERE WHCD = '4290')
			   END AS WHNM
		  FROM INTF_ORDERSTOCK A WITH (NOLOCK)
		  JOIN P006 C WITH (NOLOCK) ON A.COMPCD = C.COMPCD AND A.ORGCD = C.ORGCD AND A.MATERIALCODE = C.ITEMCD
		 WHERE A.COMPCD = #{S_COMPCD}
		   AND A.ORGCD = #{S_ORGCD}
		   AND A.COMPANYCODE = #{S_CUSTCD}
		   AND A.MATERIALCODE = #{S_ITEMCD}
		   AND A.INTF_YN = ''
		   AND CASE WHEN A.STORAGECODE = '1100' THEN '2000'
			 		WHEN A.STORAGECODE = '1180' THEN '2180'
			 		WHEN A.STORAGECODE = '1190' THEN '2190'
			 		WHEN A.STORAGECODE = '1200' THEN '4000'
			 		WHEN A.STORAGECODE = '1280' THEN '4280'
			 		WHEN A.STORAGECODE = '1290' THEN '4290'
			   END = #{S_WHCD}
		<if test="S_ORDERDATE_FROM != null and S_ORDERDATE_FROM != ''">
		   AND A.ORDERDATE >= REPLACE(#{S_ORDERDATE_FROM},'-','')
		</if>
		<if test="S_ORDERDATE_TO != null and S_ORDERDATE_TO != ''">
		   AND A.ORDERDATE <![CDATA[ <= ]]> REPLACE(#{S_ORDERDATE_TO},'-','')
		</if>	 
		 ORDER BY A.ORDERNO, ORDERDATE DESC
	</select>
	
</mapper>